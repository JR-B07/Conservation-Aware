<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tabla Interactiva</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      /* Barra de navegación personalizada con degradado */
      .navbar-custom {
        background: linear-gradient(
          to right,
          #f8a488,
          #b497d6,
          #89d6c5
        ); /* Naranja, morado, verde agua */
      }

      .navbar-custom .navbar-brand,
      .navbar-custom .nav-link {
        color: #ffffff;
        font-weight: bold;
      }

      .navbar-custom .nav-link:hover {
        color: #ffd700; /* Amarillo vibrante en hover */
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        border: 1px solid black;
        padding: 8px;
        text-align: center;
      }

      th {
        background-color: #ffd5cd; /* Color durazno claro, para complementar el naranja de la barra */
      }

      .header-group {
        background-color: #c9c9f8; /* Color lavanda claro, para complementar el morado de la barra */
        color: white;
      }

      .sub-header {
        background-color: #bff0e3; /* Verde menta claro, para complementar el verde agua de la barra */
      }

      body {
        background-color: #f0f4f8; /* Azul claro */
      }
    </style>
  </head>
  <body>
    <!-- Barra de navegación -->
    <nav class="navbar navbar-expand-lg navbar-custom">
      <a class="navbar-brand" href="{{ url_for('index') }}">INICIO</a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarNav"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('LosQFD') }}">LOS QFD</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('casa') }}">CASA</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/Tabla1">CREAR DISEÑO</a>
          </li>
        </ul>
      </div>
    </nav>

    <form id="tableForm">
      <table id="interactiveTable">
        <thead>
          <tr>
            <th rowspan="2" class="header-group">Que</th>
            <th colspan="9" class="header-group">Etapas del Proceso</th>
            <th rowspan="2" class="header-group">Acción</th>
          </tr>
          <tr id="columnHeaders">
            <th class="sub-header" contenteditable="true">
              Recepción del maíz
            </th>
            <th class="sub-header" contenteditable="true">
              Almacenaje del maíz
            </th>
            <th class="sub-header" contenteditable="true">
              Elaboración de la masa
            </th>
            <th class="sub-header" contenteditable="true">
              Lavado y escurrido de masa
            </th>
            <th class="sub-header" contenteditable="true">
              Moldeado y prensado de tortilla
            </th>
            <th class="sub-header" contenteditable="true">
              Cocción y deshidratación
            </th>
            <th class="sub-header" contenteditable="true">
              Lavado y almacenamiento
            </th>
            <th class="sub-header" contenteditable="true">
              Empaque y almacenamiento
            </th>
            <th class="sub-header" contenteditable="true">Resultado Interno</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td contenteditable="true">Color</td>
            <td contenteditable="true">5</td>
            <td contenteditable="true">5</td>
            <td contenteditable="true">5</td>
            <td contenteditable="true">3</td>
            <td contenteditable="true">5</td>
            <td contenteditable="true">5</td>
            <td contenteditable="true">3</td>
            <td contenteditable="true">1</td>
            <td contenteditable="true">5</td>
            <td>
              <button type="button" onclick="deleteRow(this)">
                Eliminar Fila
              </button>
            </td>
          </tr>
          <tr>
            <td contenteditable="true">Sabor</td>
            <td contenteditable="true">3</td>
            <td contenteditable="true">15</td>
            <td contenteditable="true">15</td>
            <td contenteditable="true">25</td>
            <td contenteditable="true">5</td>
            <td contenteditable="true">25</td>
            <td contenteditable="true">3</td>
            <td contenteditable="true">3</td>
            <td contenteditable="true">5</td>
            <td>
              <button type="button" onclick="deleteRow(this)">
                Eliminar Fila
              </button>
            </td>
          </tr>
        </tbody>
      </table>
      <button type="button" onclick="addRow()">Agregar Fila</button>
      <button type="button" onclick="addColumn()">Agregar Columna</button>
      <button type="button" onclick="deleteColumn()">Eliminar Columna</button>
      <button type="button" onclick="submitTableData()">Guardar Cambios</button>
    </form>

    <script>
      // Funciones JavaScript para manejar la tabla (agregar/eliminar filas y columnas)
      function addRow() {
        const table = document
          .getElementById("interactiveTable")
          .getElementsByTagName("tbody")[0];
        const newRow = document.createElement("tr");
        const columns = table.rows[0].cells.length - 1; // Número de columnas menos la de 'Acción'
        const firstCell = document.createElement("td");
        firstCell.contentEditable = "true";
        firstCell.textContent = "Nuevo Que";
        newRow.appendChild(firstCell);
        for (let i = 1; i < columns; i++) {
          const newCell = document.createElement("td");
          newCell.contentEditable = "true";
          newCell.textContent = "0"; // Valor por defecto
          newRow.appendChild(newCell);
        }
        const actionCell = document.createElement("td");
        const deleteButton = document.createElement("button");
        deleteButton.textContent = "Eliminar Fila";
        deleteButton.onclick = () => deleteRow(deleteButton);
        actionCell.appendChild(deleteButton);
        newRow.appendChild(actionCell);
        table.appendChild(newRow);
      }

      function addColumn() {
        const table = document.getElementById("interactiveTable");
        const headerRow = table.querySelector("#columnHeaders");
        const newHeader = document.createElement("th");
        newHeader.contentEditable = "true";
        newHeader.className = "sub-header";
        newHeader.textContent = "Nueva Columna"; // Nombre por defecto
        headerRow.appendChild(newHeader);
        const rows = table.getElementsByTagName("tbody")[0].rows;
        for (let i = 0; i < rows.length; i++) {
          const newCell = document.createElement("td");
          newCell.contentEditable = "true";
          newCell.textContent = "0"; // Valor por defecto
          rows[i].insertBefore(newCell, rows[i].lastElementChild); // Insertar antes de la última columna ('Acción')
        }
      }

      function deleteRow(button) {
        const row = button.parentNode.parentNode;
        row.parentNode.removeChild(row);
      }

      function deleteColumn() {
        const table = document.getElementById("interactiveTable");
        const headerRow = table.querySelector("#columnHeaders");
        const columnIndex =
          prompt(
            "Ingresa el número de la columna que deseas eliminar (comenzando desde 1):"
          ) - 1;
        if (columnIndex >= 0 && columnIndex < headerRow.cells.length) {
          headerRow.deleteCell(columnIndex);
          const rows = table.getElementsByTagName("tbody")[0].rows;
          for (let i = 0; i < rows.length; i++) {
            rows[i].deleteCell(columnIndex);
          }
        } else {
          alert("Número de columna no válido.");
        }
      }

      function submitTableData() {
        const table = document.querySelector("table");
        const tableData = [];
        const headers = [];
        table.querySelectorAll("thead tr:nth-child(2) th").forEach((header) => {
          headers.push(header.innerText);
        });
        table.querySelectorAll("tbody tr").forEach((row) => {
          const rowData = [];
          row.querySelectorAll("td").forEach((cell) => {
            rowData.push(cell.innerText);
          });
          tableData.push(rowData);
        });
        fetch("/update_table", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ headers: headers, data: tableData }),
        })
          .then((response) => {
            if (response.ok) {
              alert("Datos enviados exitosamente");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }
    </script>
  </body>
</html>
